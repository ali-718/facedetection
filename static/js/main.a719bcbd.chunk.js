(this["webpackJsonpopenvidu-insecure-react"]=this["webpackJsonpopenvidu-insecure-react"]||[]).push([[0],{100:function(e,n,t){},102:function(e,n,t){},104:function(e,n,t){"use strict";t.r(n);var i=t(4),s=t.n(i),o=t(50),a=t.n(o),r=(t(56),t(9)),c=t(10),d=t(5),l=t(12),u=t(11),h=t(28),v=t.n(h),b=t(51),m=(t(100),t(0)),f=function(e){Object(l.a)(t,e);var n=Object(u.a)(t);function t(e){var i;return Object(r.a)(this,t),(i=n.call(this,e)).videoRef=s.a.createRef(),i}return Object(c.a)(t,[{key:"componentDidUpdate",value:function(e){e&&this.videoRef&&this.props.streamManager.addVideoElement(this.videoRef.current)}},{key:"componentDidMount",value:function(){this.props&&this.videoRef&&this.props.streamManager.addVideoElement(this.videoRef.current)}},{key:"render",value:function(){return Object(m.jsx)("video",{controls:!1,muted:!1,autoPlay:!0,ref:this.videoRef})}}]),t}(i.Component),p=(t(102),function(e){Object(l.a)(t,e);var n=Object(u.a)(t);function t(){return Object(r.a)(this,t),n.apply(this,arguments)}return Object(c.a)(t,[{key:"getNicknameTag",value:function(){return JSON.parse(this.props.streamManager.stream.connection.data).clientData}},{key:"render",value:function(){return Object(m.jsx)("div",{children:void 0!==this.props.streamManager?Object(m.jsxs)("div",{className:"streamcomponent",children:[Object(m.jsx)(f,{streamManager:this.props.streamManager}),Object(m.jsx)("div",{children:Object(m.jsx)("p",{children:this.getNicknameTag()})})]}):null})}}]),t}(i.Component)),j="https://"+window.location.hostname+":4443",g=function(e){Object(l.a)(t,e);var n=Object(u.a)(t);function t(e){var i;return Object(r.a)(this,t),(i=n.call(this,e)).state={mySessionId:"SessionA",myUserName:"Participant"+Math.floor(100*Math.random()),session:void 0,mainStreamManager:void 0,publisher:void 0,subscribers:[]},i.joinSession=i.joinSession.bind(Object(d.a)(i)),i.leaveSession=i.leaveSession.bind(Object(d.a)(i)),i.handleChangeSessionId=i.handleChangeSessionId.bind(Object(d.a)(i)),i.handleChangeUserName=i.handleChangeUserName.bind(Object(d.a)(i)),i.handleMainVideoStream=i.handleMainVideoStream.bind(Object(d.a)(i)),i.onbeforeunload=i.onbeforeunload.bind(Object(d.a)(i)),i}return Object(c.a)(t,[{key:"componentDidMount",value:function(){window.addEventListener("beforeunload",this.onbeforeunload)}},{key:"componentWillUnmount",value:function(){window.removeEventListener("beforeunload",this.onbeforeunload)}},{key:"onbeforeunload",value:function(e){this.leaveSession()}},{key:"handleChangeSessionId",value:function(e){this.setState({mySessionId:e.target.value})}},{key:"handleChangeUserName",value:function(e){this.setState({myUserName:e.target.value})}},{key:"handleMainVideoStream",value:function(e){this.state.mainStreamManager!==e&&this.setState({mainStreamManager:e})}},{key:"deleteSubscriber",value:function(e){var n=this.state.subscribers,t=n.indexOf(e,0);t>-1&&(n.splice(t,1),this.setState({subscribers:n}))}},{key:"joinSession",value:function(){var e=this;this.OV=new b.OpenVidu,this.setState({session:this.OV.initSession()},(function(){var n=e.state.session;n.on("streamCreated",(function(t){var i=n.subscribe(t.stream,void 0),s=e.state.subscribers;s.push(i),e.setState({subscribers:s})})),n.on("streamDestroyed",(function(n){e.deleteSubscriber(n.stream.streamManager)})),n.on("exception",(function(e){console.warn(e)})),e.getToken().then((function(t){n.connect(t,{clientData:e.state.myUserName}).then((function(){var t=e.OV.initPublisher(void 0,{audioSource:void 0,videoSource:void 0,publishAudio:!0,publishVideo:!0,resolution:"640x480",frameRate:30,insertMode:"APPEND",mirror:!1});t.publishVideo(!0),n.publish(t),e.setState({mainStreamManager:t,publisher:t})})).catch((function(e){console.log("There was an error connecting to the session:",e.code,e.message)}))}))}))}},{key:"leaveSession",value:function(){var e=this.state.session;e&&e.disconnect(),this.OV=null,this.setState({session:void 0,subscribers:[],mySessionId:"SessionA",myUserName:"Participant"+Math.floor(100*Math.random()),mainStreamManager:void 0,publisher:void 0})}},{key:"render",value:function(){var e,n=this.state.mySessionId,t=this.state.myUserName;return Object(m.jsxs)("div",{className:"container",children:[void 0===this.state.session?Object(m.jsxs)("div",{id:"join",children:[Object(m.jsx)("div",{id:"img-div",children:Object(m.jsx)("img",{src:"resources/images/openvidu_grey_bg_transp_cropped.png",alt:"OpenVidu logo"})}),Object(m.jsxs)("div",{id:"join-dialog",className:"jumbotron vertical-center",children:[Object(m.jsx)("h1",{children:" Join a video session "}),Object(m.jsxs)("form",{className:"form-group",onSubmit:this.joinSession,children:[Object(m.jsxs)("p",{children:[Object(m.jsx)("label",{children:"Participant: "}),Object(m.jsx)("input",{className:"form-control",type:"text",id:"userName",value:t,onChange:this.handleChangeUserName,required:!0})]}),Object(m.jsxs)("p",{children:[Object(m.jsx)("label",{children:" Session: "}),Object(m.jsx)("input",{className:"form-control",type:"text",id:"sessionId",value:n,onChange:this.handleChangeSessionId,required:!0})]}),Object(m.jsx)("p",{className:"text-center",children:Object(m.jsx)("input",{className:"btn btn-lg btn-success",name:"commit",type:"submit",value:"JOIN"})})]})]})]}):null,void 0!==this.state.session?Object(m.jsxs)("div",{id:"session",children:[Object(m.jsxs)("div",{id:"session-header",children:[Object(m.jsx)("h1",{id:"session-title",children:n}),Object(m.jsx)("input",{className:"btn btn-large btn-danger",type:"button",id:"buttonLeaveSession",onClick:this.leaveSession,value:"Leave session"})]}),void 0!==this.state.mainStreamManager?Object(m.jsx)("div",{id:"main-video",className:"col-md-6",children:Object(m.jsx)(p,{streamManager:this.state.mainStreamManager})}):null,Object(m.jsx)("div",{id:"video-container",className:"col-md-6",children:Object(m.jsxs)("p",{children:["viewers :- ",null===(e=this.state.subscribers)||void 0===e?void 0:e.length]})})]}):null]})}},{key:"getToken",value:function(){var e=this;return this.createSession(this.state.mySessionId).then((function(n){return e.createToken(n)}))}},{key:"createSession",value:function(e){return new Promise((function(n,t){var i=JSON.stringify({customSessionId:e});v.a.post(j+"/openvidu/api/sessions",i,{headers:{Authorization:"Basic "+btoa("OPENVIDUAPP:MY_SECRET"),"Content-Type":"application/json"}}).then((function(e){console.log("CREATE SESION",e),n(e.data.id)})).catch((function(t){var i,s=Object.assign({},t);409===(null===s||void 0===s||null===(i=s.response)||void 0===i?void 0:i.status)?n(e):(console.log(s),console.warn("No connection to OpenVidu Server. This may be a certificate error at "+j),window.confirm('No connection to OpenVidu Server. This may be a certificate error at "'+j+'"\n\nClick OK to navigate and accept it. If no certificate warning is shown, then check that your OpenVidu Server is up and running at "'+j+'"')&&window.location.assign(j+"/accept-certificate"))}))}))}},{key:"createToken",value:function(e){return new Promise((function(n,t){v.a.post(j+"/openvidu/api/sessions/"+e+"/connection",{},{headers:{Authorization:"Basic "+btoa("OPENVIDUAPP:MY_SECRET"),"Content-Type":"application/json"}}).then((function(e){console.log("TOKEN",e),n(e.data.token)})).catch((function(e){return t(e)}))}))}}]),t}(i.Component),O=Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));function S(e){navigator.serviceWorker.register(e).then((function(e){e.onupdatefound=function(){var n=e.installing;n.onstatechange=function(){"installed"===n.state&&(navigator.serviceWorker.controller?console.log("New content is available; please refresh."):console.log("Content is cached for offline use."))}}})).catch((function(e){console.error("Error during service worker registration:",e)}))}a.a.render(Object(m.jsx)(g,{}),document.getElementById("root")),function(){if("serviceWorker"in navigator){if(new URL("/facedetection",window.location).origin!==window.location.origin)return;window.addEventListener("load",(function(){var e="".concat("/facedetection","/service-worker.js");O?(!function(e){fetch(e).then((function(n){404===n.status||-1===n.headers.get("content-type").indexOf("javascript")?navigator.serviceWorker.ready.then((function(e){e.unregister().then((function(){window.location.reload()}))})):S(e)})).catch((function(){console.log("No internet connection found. App is running in offline mode.")}))}(e),navigator.serviceWorker.ready.then((function(){console.log("This web app is being served cache-first by a service worker. To learn more, visit https://goo.gl/SC7cgQ")}))):S(e)}))}}()},56:function(e,n,t){}},[[104,1,2]]]);
//# sourceMappingURL=main.a719bcbd.chunk.js.map